<!DOCTYPE html>

<style>
  .box {
    width: 10px;
    height: 10px;
  }
</style>

<div>
  <template shadowroot="open">
    <style>
      .box {
        width: 10px;
        height: 10px;
      }
    </style>
    <div class="box"></div>
    <div id="target1shadow" style="position: relative">
      <div class="box"></div>
      <slot></slot>
    </div>
  </template>
  <div class="box"></div>
  <div id="target1" style="position: absolute" class="box"></div>
</div>

<span>
  <template shadowroot="open">
    <style>
      .box {
        width: 10px;
        height: 10px;
      }
    </style>
    <span class="box"></span>
    <span id="target2shadow" style="position: relative">
      <span class="box"></span>
      <slot></slot>
    </span>
  </template>
  <span class="box"></span>
  <span id="target2" style="position: absolute" class="box"></span>
</span>

<div>
  <template shadowroot="open">
    <style>
      .box {
        width: 10px;
        height: 10px;
      }
    </style>
    <div class="box"></div>
    <div id="target3shadowouter" style="position: relative">
      <div class="box"></div>
      <div>
        <template shadowroot="open">
          <style>
            .box {
              width: 10px;
              height: 10px;
            }
          </style>
          <div class="box"></div>
          <div id="target3shadowinner" style="position: relative">
            <div class="box"></div>
            <slot></slot>
          </div>
        </template>
        <slot></slot>
      </div>
    </div>
  </template>
  <div class="box"></div>
  <div id="target3" style="position: absolute" class="box"></div>
</div>

<div id="output"></div>

<script>
  (function attachShadowRoots(root) {
    root.querySelectorAll("template[shadowroot]").forEach((template) => {
      const mode = template.getAttribute("shadowroot");
      const shadowRoot = template.parentNode.attachShadow({ mode });
      shadowRoot.appendChild(template.content);
      template.remove();
      attachShadowRoots(shadowRoot);
    });
  })(document);
</script>

<script type="module">
  import {
    offsetTop,
    offsetLeft,
    offsetParent,
  } from "../dist/composed-offset-position.esm.js";

  function log(str) {
    output.insertAdjacentHTML("beforeend", `<div>${str}</div>`);
  }

  log("offsetTop");
  log("target1 ponyfill: " + offsetTop(target1));
  log("target2 ponyfill: " + offsetTop(target2));
  log("target3 ponyfill: " + offsetTop(target3));
  log(`target1 native: ${target1.offsetTop}`);
  log(`target2 native: ${target2.offsetTop}`);
  log(`target3 native: ${target3.offsetTop}`);
  log(`\n`);

  log("offsetLeft");
  log("target1 ponyfill: " + offsetLeft(target1));
  log("target2 ponyfill: " + offsetLeft(target2));
  log("target3 ponyfill: " + offsetLeft(target3));
  log(`target1 native: ${target1.offsetLeft}`);
  log(`target2 native: ${target2.offsetLeft}`);
  log(`target3 native: ${target3.offsetLeft}`);
  log(`\n`);

  log("offsetParentt");
  log(
    `target1 offsetParent ponyfill: ${offsetParent(target1).tagName} ${
      offsetParent(target1).id
    }`
  );
  log(
    `target2 offsetParent ponyfill: ${offsetParent(target2).tagName} ${
      offsetParent(target2).id
    }`
  );
  log(
    `target3 offsetParent ponyfill: ${offsetParent(target3).tagName} ${
      offsetParent(target3).id
    }`
  );
  log(
    `target1 offsetParent native: ${target1.offsetParent.tagName} ${target1.offsetParent.id}`
  );
  log(
    `target2 offsetParent native: ${target2.offsetParent.tagName} ${target2.offsetParent.id}`
  );
  log(
    `target3 offsetParent native: ${target3.offsetParent.tagName} ${target3.offsetParent.id}`
  );
</script>
